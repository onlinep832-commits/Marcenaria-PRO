<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-7068124591666531">
    <title>Marcenaria PRO - Sistema de Or√ßamento</title>
    
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --cor-principal: #6366f1;
            --cor-secundaria: #8b5cf6;
            --cor-sucesso: #10b981;
            --cor-aviso: #f59e0b;
            --cor-erro: #ef4444;
            --cor-fundo: #f8fafc;
            --cor-card: #ffffff;
            --cor-texto: #1e293b;
            --cor-texto-claro: #64748b;
            --cor-borda: #e2e8f0;
            --sombra-card: 0 1px 3px rgba(0, 0, 0, 0.1);
            --sombra-hover: 0 4px 12px rgba(99, 102, 241, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--cor-texto);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--cor-fundo);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, var(--cor-principal), var(--cor-secundaria));
            border-radius: var(--border-radius);
            color: white;
        }
        
        header h1 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: var(--cor-card);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--sombra-card);
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: var(--sombra-hover);
            transform: translateY(-2px);
        }
        
        h2 {
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: var(--cor-principal);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h3 {
            color: var(--cor-texto);
            margin: 20px 0 15px;
            font-size: 1.3rem;
        }
        
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--cor-principal);
            color: white;
        }
        
        .btn-primary:hover {
            background: #5558e3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: var(--cor-texto-claro);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .btn-success {
            background: var(--cor-sucesso);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: var(--cor-aviso);
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--cor-borda);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--cor-principal);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .module-card {
            border: 2px solid var(--cor-borda);
            border-radius: var(--border-radius);
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .module-card:hover {
            border-color: var(--cor-principal);
            transform: scale(1.02);
            box-shadow: var(--sombra-hover);
        }
        
        .module-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .module-card h4 {
            color: var(--cor-texto);
            margin-bottom: 5px;
        }
        
        .module-card .category {
            color: var(--cor-texto-claro);
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast-success {
            border-left: 4px solid var(--cor-sucesso);
        }
        
        .toast-error {
            border-left: 4px solid var(--cor-erro);
        }
        
        .toast-warning {
            border-left: 4px solid var(--cor-aviso);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--cor-borda);
        }
        
        th {
            background: var(--cor-fundo);
            color: var(--cor-texto);
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--cor-fundo);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .badge-primary {
            background: rgba(99, 102, 241, 0.1);
            color: var(--cor-principal);
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--cor-sucesso);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .nav-buttons {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü™µ Marcenaria PRO</h1>
            <p>Sistema Profissional de Or√ßamento e Gest√£o</p>
        </header>
        
        <main id="app">
            <!-- Navigation -->
            <div class="card">
                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="app.showView('projeto')">üìã Novo Projeto</button>
                    <button class="btn btn-warning" onclick="app.showView('modulos')">üîß M√≥dulos</button>
                    <button class="btn btn-secondary" onclick="app.showView('catalogos')">üìö Cat√°logos</button>
                    <button class="btn btn-primary" onclick="app.showView('projetos')">üìÅ Meus Projetos</button>
                    <button class="btn btn-secondary" onclick="app.showView('config')">‚öôÔ∏è Configura√ß√µes</button>
                </div>
            </div>
            
            <!-- Projeto View -->
            <div id="view-projeto" class="app-view">
                <div class="card">
                    <h2>üìã Novo Projeto</h2>
                    <h3>Dados do Cliente</h3>
                    <div class="form-grid">
                        <input type="text" id="nomeCliente" placeholder="Nome do Cliente">
                        <input type="text" id="nomeAmbiente" placeholder="Ambiente (ex: Cozinha)">
                        <input type="date" id="dataProjeto">
                    </div>
                    
                    <h3>Dimens√µes do Projeto</h3>
                    <div class="form-grid">
                        <input type="number" id="altura" placeholder="Altura (mm)" value="720">
                        <input type="number" id="largura" placeholder="Largura (mm)" value="600">
                        <input type="number" id="profundidade" placeholder="Profundidade (mm)" value="300">
                    </div>
                    
                    <h3>Cores</h3>
                    <div class="form-grid">
                        <select id="corInterna">
                            <option value="">Selecione cor interna</option>
                        </select>
                        <select id="corExterna">
                            <option value="">Selecione cor externa</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" onclick="app.salvarProjeto()">üíæ Salvar Projeto</button>
                    <button class="btn btn-primary" onclick="app.gerarPDF()">üìÑ Gerar PDF</button>
                </div>
                
                <div class="card">
                    <h2>üîß Selecionar M√≥dulos</h2>
                    <div id="modulosList" class="module-grid"></div>
                </div>
            </div>
            
            <!-- M√≥dulos View -->
            <div id="view-modulos" class="app-view hidden">
                <div class="card">
                    <h2>üîß Gerenciar M√≥dulos</h2>
                    <div id="modulosManager" class="module-grid"></div>
                </div>
            </div>
            
            <!-- Cat√°logos View -->
            <div id="view-catalogos" class="app-view hidden">
                <div class="card">
                    <h2>üìö Cat√°logos</h2>
                    <h3>Cores MDF</h3>
                    <table id="coresMDFTable">
                        <thead>
                            <tr>
                                <th>Cor</th>
                                <th>Pre√ßo Chapa (R$)</th>
                                <th>Pre√ßo m¬≤ (R$)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    
                    <h3>Ferragens</h3>
                    <table id="ferragensTable">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Pre√ßo (R$)</th>
                                <th>Unidade</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Projetos View -->
            <div id="view-projetos" class="app-view hidden">
                <div class="card">
                    <h2>üìÅ Meus Projetos</h2>
                    <div id="projetosList"></div>
                </div>
            </div>
            
            <!-- Configura√ß√µes View -->
            <div id="view-config" class="app-view hidden">
                <div class="card">
                    <h2>‚öôÔ∏è Configura√ß√µes</h2>
                    <p>Configura√ß√µes do sistema</p>
                    <div class="form-grid">
                        <div>
                            <label>Margem de Lucro (%)</label>
                            <input type="number" id="margemLucro" value="50">
                        </div>
                        <div>
                            <label>Espessura Interna (mm)</label>
                            <input type="number" id="espInterna" value="15">
                        </div>
                        <div>
                            <label>Espessura Externa (mm)</label>
                            <input type="number" id="espExterna" value="18">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="app.salvarConfig()">üíæ Salvar Configura√ß√µes</button>
                </div>
            </div>
        </main>
    </div>
    
    <div id="toast-container"></div>
    
    <!-- Load data files -->
    <script src="dados.js"></script>
    <script src="dados-clientes.js"></script>
    
    <!-- Main Application Script -->
    <script>
        const app = {
            currentProject: {},
            currentView: 'projeto',
            
            init() {
                console.log('Inicializando Marcenaria PRO...');
                this.loadColors();
                this.loadModules();
                this.loadCatalogos();
                this.setDefaultDate();
                this.showToast('Sistema carregado com sucesso!', 'success');
            },
            
            showView(viewName) {
                document.querySelectorAll('.app-view').forEach(view => {
                    view.classList.add('hidden');
                });
                document.getElementById(`view-${viewName}`).classList.remove('hidden');
                this.currentView = viewName;
            },
            
            setDefaultDate() {
                const dateInput = document.getElementById('dataProjeto');
                if (dateInput) {
                    dateInput.valueAsDate = new Date();
                }
            },
            
            loadColors() {
                if (!window.DADOS_DO_SISTEMA) return;
                
                const coresMDF = window.DADOS_DO_SISTEMA.coresMDF || {};
                const selectInterna = document.getElementById('corInterna');
                const selectExterna = document.getElementById('corExterna');
                
                Object.keys(coresMDF).forEach(key => {
                    const cor = coresMDF[key];
                    const option1 = new Option(cor.nome, key);
                    const option2 = new Option(cor.nome, key);
                    selectInterna.add(option1);
                    selectExterna.add(option2);
                });
            },
            
            loadModules() {
                if (!window.DADOS_DO_SISTEMA) return;
                
                const modulos = window.DADOS_DO_SISTEMA.catalogoModulos || [];
                const container = document.getElementById('modulosList');
                const managerContainer = document.getElementById('modulosManager');
                
                if (!container) return;
                
                container.innerHTML = '';
                if (managerContainer) managerContainer.innerHTML = '';
                
                modulos.forEach(modulo => {
                    const card = this.createModuleCard(modulo);
                    container.appendChild(card);
                    if (managerContainer) {
                        managerContainer.appendChild(card.cloneNode(true));
                    }
                });
            },
            
            createModuleCard(modulo) {
                const card = document.createElement('div');
                card.className = 'module-card';
                card.innerHTML = `
                    ${modulo.imagem ? `<img src="${modulo.imagem}" alt="${modulo.nome}" onerror="this.src='https://via.placeholder.com/250x150?text=Sem+Imagem'">` : ''}
                    <h4>${modulo.nome}</h4>
                    <p class="category">${modulo.categoria || 'Sem categoria'}</p>
                    <span class="badge badge-primary">${modulo.pecas?.length || 0} pe√ßas</span>
                `;
                return card;
            },
            
            loadCatalogos() {
                if (!window.DADOS_DO_SISTEMA) return;
                
                // Load cores MDF
                const coresMDF = window.DADOS_DO_SISTEMA.coresMDF || {};
                const coresTbody = document.querySelector('#coresMDFTable tbody');
                if (coresTbody) {
                    coresTbody.innerHTML = '';
                    Object.values(coresMDF).forEach(cor => {
                        const row = coresTbody.insertRow();
                        row.innerHTML = `
                            <td>${cor.nome}</td>
                            <td>R$ ${cor.precoChapa?.toFixed(2) || '0.00'}</td>
                            <td>R$ ${cor.preco?.toFixed(2) || '0.00'}</td>
                        `;
                    });
                }
                
                // Load ferragens
                const ferragens = window.DADOS_DO_SISTEMA.catalogoFerragens || {};
                const ferragensTbody = document.querySelector('#ferragensTable tbody');
                if (ferragensTbody) {
                    ferragensTbody.innerHTML = '';
                    Object.values(ferragens).forEach(ferragem => {
                        const row = ferragensTbody.insertRow();
                        row.innerHTML = `
                            <td>${ferragem.nome}</td>
                            <td>R$ ${ferragem.preco?.toFixed(2) || '0.00'}</td>
                            <td>${ferragem.unidade || 'UN'}</td>
                        `;
                    });
                }
            },
            
            salvarProjeto() {
                const projeto = {
                    id: Date.now(),
                    nomeCliente: document.getElementById('nomeCliente').value,
                    nomeAmbiente: document.getElementById('nomeAmbiente').value,
                    data: document.getElementById('dataProjeto').value,
                    dimensoes: {
                        altura: document.getElementById('altura').value,
                        largura: document.getElementById('largura').value,
                        profundidade: document.getElementById('profundidade').value
                    },
                    cores: {
                        interna: document.getElementById('corInterna').value,
                        externa: document.getElementById('corExterna').value
                    }
                };
                
                if (!projeto.nomeCliente || !projeto.nomeAmbiente) {
                    this.showToast('Preencha os dados obrigat√≥rios!', 'error');
                    return;
                }
                
                // Save to localStorage
                let projetos = JSON.parse(localStorage.getItem('projetos') || '[]');
                projetos.push(projeto);
                localStorage.setItem('projetos', JSON.stringify(projetos));
                
                this.showToast('Projeto salvo com sucesso!', 'success');
                this.currentProject = projeto;
            },
            
            gerarPDF() {
                if (!this.currentProject.nomeCliente) {
                    this.showToast('Salve o projeto primeiro!', 'warning');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.text('Marcenaria PRO', 20, 20);
                
                doc.setFontSize(16);
                doc.text('Or√ßamento', 20, 30);
                
                // Client info
                doc.setFontSize(12);
                doc.text(`Cliente: ${this.currentProject.nomeCliente}`, 20, 45);
                doc.text(`Ambiente: ${this.currentProject.nomeAmbiente}`, 20, 52);
                doc.text(`Data: ${this.currentProject.data}`, 20, 59);
                
                // Dimensions
                doc.text('Dimens√µes:', 20, 70);
                doc.setFontSize(10);
                doc.text(`Altura: ${this.currentProject.dimensoes.altura}mm`, 25, 77);
                doc.text(`Largura: ${this.currentProject.dimensoes.largura}mm`, 25, 82);
                doc.text(`Profundidade: ${this.currentProject.dimensoes.profundidade}mm`, 25, 87);
                
                doc.save(`orcamento-${this.currentProject.nomeCliente}-${Date.now()}.pdf`);
                this.showToast('PDF gerado com sucesso!', 'success');
            },
            
            salvarConfig() {
                const config = {
                    margemLucro: document.getElementById('margemLucro').value,
                    espInterna: document.getElementById('espInterna').value,
                    espExterna: document.getElementById('espExterna').value
                };
                
                localStorage.setItem('config', JSON.stringify(config));
                this.showToast('Configura√ß√µes salvas!', 'success');
            },
            
            showToast(message, type = 'success') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.textContent = message;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        };
        
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
        
        // Make app globally available
        window.app = app;
    </script>
</body>
</html>
